import{r as f,E as w,j as O,b as j,o as c,d as u,f as t,g as h,t as a,h as T,q as b,v as _,D as R,z as q,F as B,C as N,n as z}from"./vendor-24875fe8.js";import{_ as I,S as L,s as m}from"./index-38f5e110.js";import{f as U}from"./formatters-b73e5c82.js";const A={name:"ReportsView",components:{SidebarMenu:L},setup(){const x=f([]),e=f(!0),g=f(!1),s=f(JSON.parse(localStorage.getItem("user")||"{}")),y=()=>{g.value=!g.value},d=w({dateFrom:"",dateTo:"",status:""}),n=w({totalOrders:0,totalSales:0,averageOrderValue:0}),o=async()=>{e.value=!0;try{const{data:{session:l}}=await m.auth.getSession();if(!l){e.value=!1;return}if(!l.user||!l.user.id){console.error("معرف المستخدم غير متوفر"),e.value=!1;return}const{data:i}=await m.from("users").select("role").eq("id",l.user.id).single();let r=m.from("orders").select("*");if(i&&i.role==="representative"&&(r=r.eq("sales_rep_id",l.user.id)),d.dateFrom&&(r=r.gte("created_at",d.dateFrom)),d.dateTo){const p=new Date(d.dateTo);p.setDate(p.getDate()+1),r=r.lt("created_at",p.toISOString())}d.status&&(r=r.eq("status",d.status)),r=r.order("created_at",{ascending:!1});const{data:D,error:v}=await r;if(v)throw v;x.value=D||[],k()}catch(l){console.error("خطأ في جلب الطلبات:",l)}finally{e.value=!1}},k=()=>{if(n.totalOrders=x.value.length,n.totalOrders>0){const l=x.value.reduce((i,r)=>i+(parseFloat(r.total)||0),0);n.totalSales=l.toFixed(2),n.averageOrderValue=(l/n.totalOrders).toFixed(2)}else n.totalSales="0.00",n.averageOrderValue="0.00"},S=()=>{o()},C=l=>l?new Date(l).toLocaleDateString("ar-SA"):"",M=l=>({new:"جديد",completed_pending_delivery:"مكتمل بانتظار التسليم",delivered:"تم التسليم",cancelled:"ملغى"})[l]||l,V=l=>({new:"bg-blue-100 text-blue-800 py-1 px-2 rounded-full text-xs",completed_pending_delivery:"bg-yellow-100 text-yellow-800 py-1 px-2 rounded-full text-xs",delivered:"bg-green-100 text-green-800 py-1 px-2 rounded-full text-xs",cancelled:"bg-red-100 text-red-800 py-1 px-2 rounded-full text-xs"})[l]||"",F=()=>{window.print()};return O(()=>{o()}),{orders:x,loading:e,filters:d,summary:n,user:s,showMobileSidebar:g,toggleSidebar:y,applyFilters:S,formatDate:C,formatCurrency:U,getStatusText:M,getStatusClass:V,printReport:F}}},E={class:"min-h-screen bg-gray-50"},J={class:"flex h-screen overflow-hidden"},G={class:"flex-1 flex flex-col overflow-hidden"},H={class:"bg-white shadow-sm z-10"},K={class:"flex items-center justify-between p-4"},P={class:"flex items-center"},Q={class:"flex items-center"},W={class:"text-sm text-gray-600 ml-2"},X={class:"w-8 h-8 rounded-full bg-sky-500 flex items-center justify-center text-white"},Y={key:0,class:"fixed inset-0 z-20 md:hidden"},Z={class:"absolute inset-y-0 right-0 w-64 bg-sky-800 text-white"},$={class:"p-4 border-b border-sky-700 flex justify-between items-center"},tt={class:"flex-1 overflow-y-auto p-4"},et={class:"bg-white rounded-lg shadow-md p-6"},st={class:"mb-8 grid grid-cols-1 md:grid-cols-3 gap-4"},ot={class:"mb-4"},lt={class:"mb-4"},rt={class:"mb-4"},nt={class:"flex justify-center mb-8"},at={class:"overflow-x-auto"},dt={class:"min-w-full bg-white"},it={key:0,class:"text-center"},ct={key:1,class:"text-center"},ut={class:"py-3 px-4 text-center"},xt={class:"py-3 px-4 text-center"},gt={class:"py-3 px-4 text-center"},ft={class:"py-3 px-4 text-center"},pt={class:"py-3 px-4 text-center"},bt={class:"mt-8 p-4 bg-sky-50 rounded-lg"},mt={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},yt={class:"bg-white p-4 rounded-lg shadow text-center"},vt={class:"text-2xl font-bold text-sky-700"},wt={class:"bg-white p-4 rounded-lg shadow text-center"},ht={class:"text-2xl font-bold text-sky-700"},_t={class:"bg-white p-4 rounded-lg shadow text-center"},kt={class:"text-2xl font-bold text-sky-700"},St={class:"flex justify-center mt-8"};function Ct(x,e,g,s,y,d){const n=j("SidebarMenu");return c(),u("div",E,[t("div",J,[h(n,{user:s.user},null,8,["user"]),t("div",G,[t("header",H,[t("div",K,[t("div",P,[t("button",{onClick:e[0]||(e[0]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o)),class:"md:hidden ml-2"},e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])),e[9]||(e[9]=t("h2",{class:"text-xl font-semibold text-gray-800"},"تقارير المبيعات",-1))]),t("div",Q,[t("span",W,a(s.user.name),1),t("div",X,a(s.user.name.charAt(0)),1)])])]),s.showMobileSidebar?(c(),u("div",Y,[t("div",{class:"absolute inset-0 bg-black opacity-50",onClick:e[1]||(e[1]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o))}),t("div",Z,[t("div",$,[e[11]||(e[11]=t("h1",{class:"text-xl font-bold"},"نظام إدارة الطلبات",-1)),t("button",{onClick:e[2]||(e[2]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o))},e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),h(n,{user:s.user,mobile:"",onItemClick:s.toggleSidebar},null,8,["user","onItemClick"])])])):T("",!0),t("main",tt,[t("div",et,[e[23]||(e[23]=t("h1",{class:"text-2xl font-bold text-sky-700 mb-6 text-center"},"تقارير المبيعات",-1)),t("div",st,[t("div",ot,[e[12]||(e[12]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"date-from"}," من تاريخ ",-1)),b(t("input",{type:"date",id:"date-from","onUpdate:modelValue":e[3]||(e[3]=o=>s.filters.dateFrom=o),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"},null,512),[[_,s.filters.dateFrom]])]),t("div",lt,[e[13]||(e[13]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"date-to"}," إلى تاريخ ",-1)),b(t("input",{type:"date",id:"date-to","onUpdate:modelValue":e[4]||(e[4]=o=>s.filters.dateTo=o),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"},null,512),[[_,s.filters.dateTo]])]),t("div",rt,[e[15]||(e[15]=t("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"status"}," حالة الطلب ",-1)),b(t("select",{id:"status","onUpdate:modelValue":e[5]||(e[5]=o=>s.filters.status=o),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"},e[14]||(e[14]=[q('<option value="">جميع الحالات</option><option value="new">جديد</option><option value="completed_pending_delivery">مكتمل بانتظار التسليم</option><option value="delivered">تم التسليم</option><option value="cancelled">ملغى</option>',5)]),512),[[R,s.filters.status]])])]),t("div",nt,[t("button",{onClick:e[6]||(e[6]=(...o)=>s.applyFilters&&s.applyFilters(...o)),class:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline"}," تطبيق الفلتر ")]),t("div",at,[t("table",dt,[e[18]||(e[18]=t("thead",null,[t("tr",null,[t("th",{class:"py-3 px-4 bg-sky-100 text-center text-sky-800 font-semibold"},"رقم الطلب"),t("th",{class:"py-3 px-4 bg-sky-100 text-center text-sky-800 font-semibold"},"اسم العميل"),t("th",{class:"py-3 px-4 bg-sky-100 text-center text-sky-800 font-semibold"},"تاريخ الطلب"),t("th",{class:"py-3 px-4 bg-sky-100 text-center text-sky-800 font-semibold"},"المبلغ الإجمالي"),t("th",{class:"py-3 px-4 bg-sky-100 text-center text-sky-800 font-semibold"},"حالة الطلب")])],-1)),t("tbody",null,[s.loading?(c(),u("tr",it,e[16]||(e[16]=[t("td",{colspan:"5",class:"py-4"},"جاري تحميل البيانات...",-1)]))):s.orders.length===0?(c(),u("tr",ct,e[17]||(e[17]=[t("td",{colspan:"5",class:"py-4"},"لا توجد بيانات متاحة",-1)]))):(c(!0),u(B,{key:2},N(s.orders,o=>(c(),u("tr",{key:o.id,class:"border-b hover:bg-gray-50"},[t("td",ut,a(o.id),1),t("td",xt,a(o.customer_name),1),t("td",gt,a(s.formatDate(o.created_at)),1),t("td",ft,a(s.formatCurrency(o.total)),1),t("td",pt,[t("span",{class:z(s.getStatusClass(o.status))},a(s.getStatusText(o.status)),3)])]))),128))])])]),t("div",bt,[e[22]||(e[22]=t("h2",{class:"text-xl font-bold text-sky-700 mb-4 text-center"},"ملخص التقرير",-1)),t("div",mt,[t("div",yt,[e[19]||(e[19]=t("p",{class:"text-gray-600 mb-2"},"إجمالي عدد الطلبات",-1)),t("p",vt,a(s.summary.totalOrders),1)]),t("div",wt,[e[20]||(e[20]=t("p",{class:"text-gray-600 mb-2"},"إجمالي المبيعات",-1)),t("p",ht,a(s.formatCurrency(s.summary.totalSales)),1)]),t("div",_t,[e[21]||(e[21]=t("p",{class:"text-gray-600 mb-2"},"متوسط قيمة الطلب",-1)),t("p",kt,a(s.formatCurrency(s.summary.averageOrderValue)),1)])])]),t("div",St,[t("button",{onClick:e[7]||(e[7]=(...o)=>s.printReport&&s.printReport(...o)),class:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline"}," طباعة التقرير ")])])])])])])}const Dt=I(A,[["render",Ct]]);export{Dt as default};
