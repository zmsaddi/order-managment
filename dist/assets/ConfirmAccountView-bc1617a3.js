import{i as k,u as V,r as l,b as C,o as m,d as u,f as e,n as A,t as N,h as S,l as q,q as x,v as w,z as E,g as I,w as j,A as B}from"./vendor-24875fe8.js";import{_ as D,s as f}from"./index-38f5e110.js";const O={name:"ConfirmAccountView",setup(){const p=k(),s=V(),n=l(""),t=l(""),d=l(!1),r=l(""),o=l(""),a=p.query.token||"",y=p.query.type||"";return{email:n,password:t,loading:d,message:r,messageClass:o,confirmAccount:async()=>{d.value=!0,r.value="",o.value="";try{if(!a||y!=="signup")throw new Error("رابط التأكيد غير صالح");const{error:i}=await f.auth.verifyOtp({token_hash:a,type:"signup",email:n.value,options:{password:t.value}});if(i)throw i;const{data:c,error:v}=await f.auth.signInWithPassword({email:n.value,password:t.value});if(v)throw v;const{data:_,error:b}=await f.from("users").select("*").eq("id",c.user.id).single();if(b){const{data:h,error:g}=await f.from("users").insert([{id:c.user.id,email:c.user.email,name:c.user.email.split("@")[0],role:"representative",status:"active"}]).select().single();if(g)throw g;localStorage.setItem("user",JSON.stringify(h))}else localStorage.setItem("user",JSON.stringify(_));r.value="تم تأكيد الحساب بنجاح. جاري تحويلك إلى لوحة التحكم...",o.value="bg-green-50 text-green-800",setTimeout(()=>{s.push({name:"dashboard"})},2e3)}catch(i){console.error("خطأ في تأكيد الحساب:",i),r.value=i.message||"حدث خطأ أثناء تأكيد الحساب",o.value="bg-red-50 text-red-800"}finally{d.value=!1}}}}},T={class:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8"},U={class:"mt-8 sm:mx-auto sm:w-full sm:max-w-md"},z={class:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10"},J={class:"text-sm"},M={class:"mt-1"},R=["disabled"],P={class:"mt-1"},W=["disabled"],F=["disabled"],G={key:0},H={key:1},K={class:"mt-6"},L={class:"mt-6"};function Q(p,s,n,t,d,r){const o=C("router-link");return m(),u("div",T,[s[7]||(s[7]=e("div",{class:"sm:mx-auto sm:w-full sm:max-w-md"},[e("h2",{class:"mt-6 text-center text-3xl font-bold text-gray-900"},"تأكيد الحساب"),e("p",{class:"mt-2 text-center text-sm text-gray-600"}," قم بإدخال بريدك الإلكتروني وكلمة المرور التي زودك بها المدير لتأكيد حسابك ")],-1)),e("div",U,[e("div",z,[t.message?(m(),u("div",{key:0,class:A(["rounded-md p-4 mb-4",t.messageClass])},[e("p",J,N(t.message),1)],2)):S("",!0),e("form",{class:"space-y-6",onSubmit:s[2]||(s[2]=q((...a)=>t.confirmAccount&&t.confirmAccount(...a),["prevent"]))},[e("div",null,[s[3]||(s[3]=e("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"البريد الإلكتروني",-1)),e("div",M,[x(e("input",{id:"email","onUpdate:modelValue":s[0]||(s[0]=a=>t.email=a),type:"email",autocomplete:"email",required:"",class:"form-input",disabled:t.loading,placeholder:"أدخل بريدك الإلكتروني"},null,8,R),[[w,t.email]])])]),e("div",null,[s[4]||(s[4]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"كلمة المرور",-1)),e("div",P,[x(e("input",{id:"password","onUpdate:modelValue":s[1]||(s[1]=a=>t.password=a),type:"password",autocomplete:"current-password",required:"",class:"form-input",disabled:t.loading,placeholder:"أدخل كلمة المرور"},null,8,W),[[w,t.password]])])]),e("div",null,[e("button",{type:"submit",class:"w-full btn btn-primary",disabled:t.loading},[t.loading?(m(),u("span",G,"جاري التأكيد...")):(m(),u("span",H,"تأكيد الحساب"))],8,F)])],32),e("div",K,[s[6]||(s[6]=E('<div class="relative" data-v-f4c77a89><div class="absolute inset-0 flex items-center" data-v-f4c77a89><div class="w-full border-t border-gray-300" data-v-f4c77a89></div></div><div class="relative flex justify-center text-sm" data-v-f4c77a89><span class="px-2 bg-white text-gray-500" data-v-f4c77a89>أو</span></div></div>',1)),e("div",L,[I(o,{to:"/login",class:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},{default:j(()=>s[5]||(s[5]=[B(" العودة إلى تسجيل الدخول ")])),_:1,__:[5]})])])])])])}const $=D(O,[["render",Q],["__scopeId","data-v-f4c77a89"]]);export{$ as default};
