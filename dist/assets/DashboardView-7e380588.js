import{_ as Q,s as u}from"./index-38f5e110.js";import{U}from"./UserProfileMenu-75217797.js";import{f as P,a as A,g as F,b as I}from"./formatters-b73e5c82.js";import{r as m,B as H,a as J,j as L,b as M,o as i,d as p,f as t,g as y,t as a,h as V,F as R,C as G,w as _,z as K,n as W,A as b,k as X}from"./vendor-24875fe8.js";const Y={name:"DashboardView",components:{UserProfileMenu:U},setup(){const x=m(!0),e=m([]),l=m({totalOrders:0,completedOrders:0,newOrders:0,totalSales:0}),s=m(JSON.parse(localStorage.getItem("user")||"{}")),k=H("toggleSidebar"),g=J(()=>["admin","sales_manager"].includes(s.value.role)),v=r=>g.value?!0:s.value.id===r.sales_rep_id,n=r=>F(r),o=r=>I(r),j=(r,d)=>r?r.length>d?r.substring(0,d)+"...":r:"",B=async()=>{try{x.value=!0;let r=u.from("orders").select("*").order("created_at",{ascending:!1}).limit(5);s.value.role==="representative"&&(r=r.eq("sales_rep_id",s.value.id));const{data:d,error:c}=await r;if(c)throw c;e.value=d}catch(r){console.error("خطأ في جلب أحدث الطلبات:",r)}finally{x.value=!1}},q=async()=>{try{let r=u.from("orders").select("id",{count:"exact",head:!0});s.value.role==="representative"&&(r=r.eq("sales_rep_id",s.value.id));const{count:d,error:c}=await r;if(c)throw c;l.value.totalOrders=d||0;let f=u.from("orders").select("id",{count:"exact",head:!0}).eq("status","delivered");s.value.role==="representative"&&(f=f.eq("sales_rep_id",s.value.id));const{count:z,error:C}=await f;if(C)throw C;l.value.completedOrders=z||0;let w=u.from("orders").select("id",{count:"exact",head:!0}).eq("status","new");s.value.role==="representative"&&(w=w.eq("sales_rep_id",s.value.id));const{count:D,error:O}=await w;if(O)throw O;l.value.newOrders=D||0;let h=u.from("orders").select("total").eq("status","delivered");s.value.role==="representative"&&(h=h.eq("sales_rep_id",s.value.id));const{data:E,error:S}=await h;if(S)throw S;l.value.totalSales=E.reduce((N,T)=>N+T.total,0)}catch(r){console.error("خطأ في جلب إحصائيات الطلبات:",r)}};return L(()=>{document.title="لوحة التحكم - نظام إدارة الطلبات",B(),q()}),{user:s,loading:x,recentOrders:e,stats:l,isAdmin:g,toggleSidebar:k,canEditOrder:v,getStatusText:n,getStatusClass:o,truncateText:j,formatCurrency:P,formatDate:A}}},Z={class:"bg-white shadow-sm z-10"},$={class:"flex items-center justify-between p-4"},tt={class:"flex items-center"},et={class:"flex items-center"},st={class:"flex-1 overflow-y-auto p-4"},rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6"},ot={class:"bg-white rounded-lg shadow-sm p-4"},at={class:"flex items-center"},lt={class:"text-2xl font-semibold text-gray-800"},dt={class:"bg-white rounded-lg shadow-sm p-4"},it={class:"flex items-center"},nt={class:"text-2xl font-semibold text-gray-800"},ct={class:"bg-white rounded-lg shadow-sm p-4"},ut={class:"flex items-center"},pt={class:"text-2xl font-semibold text-gray-800"},xt={class:"bg-white rounded-lg shadow-sm p-4"},mt={class:"flex items-center"},gt={class:"text-2xl font-semibold text-gray-800"},vt={class:"bg-white rounded-lg shadow-sm mb-6"},ft={class:"overflow-x-auto"},wt={class:"min-w-full divide-y divide-gray-200"},ht={class:"bg-white divide-y divide-gray-200"},yt={key:0},_t={key:1},bt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ct={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ot={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},St={class:"px-6 py-4 whitespace-nowrap"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Vt={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},jt={class:"p-4 border-t border-gray-200 text-center"};function Bt(x,e,l,s,k,g){const v=M("UserProfileMenu"),n=M("router-link");return i(),p("div",null,[t("header",Z,[t("div",$,[t("div",tt,[t("button",{onClick:e[0]||(e[0]=(...o)=>s.toggleSidebar&&s.toggleSidebar(...o)),class:"md:hidden ml-2"},e[1]||(e[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])),e[2]||(e[2]=t("h2",{class:"text-xl font-semibold text-gray-800"},"لوحة التحكم",-1))]),t("div",et,[y(v,{user:s.user},null,8,["user"])])])]),t("main",st,[t("div",rt,[t("div",ot,[t("div",at,[e[4]||(e[4]=t("div",{class:"p-3 rounded-full bg-sky-100 text-sky-600 ml-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1)),t("div",null,[e[3]||(e[3]=t("p",{class:"text-gray-500 text-sm"},"إجمالي الطلبات",-1)),t("p",lt,a(s.stats.totalOrders),1)])])]),t("div",dt,[t("div",it,[e[6]||(e[6]=t("div",{class:"p-3 rounded-full bg-green-100 text-green-600 ml-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[e[5]||(e[5]=t("p",{class:"text-gray-500 text-sm"},"الطلبات المكتملة",-1)),t("p",nt,a(s.stats.completedOrders),1)])])]),t("div",ct,[t("div",ut,[e[8]||(e[8]=t("div",{class:"p-3 rounded-full bg-yellow-100 text-yellow-600 ml-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[e[7]||(e[7]=t("p",{class:"text-gray-500 text-sm"},"الطلبات الجديدة",-1)),t("p",pt,a(s.stats.newOrders),1)])])]),t("div",xt,[t("div",mt,[e[10]||(e[10]=t("div",{class:"p-3 rounded-full bg-purple-100 text-purple-600 ml-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",null,[e[9]||(e[9]=t("p",{class:"text-gray-500 text-sm"},"إجمالي المبيعات",-1)),t("p",gt,a(s.formatCurrency(s.stats.totalSales)),1)])])])]),t("div",vt,[e[17]||(e[17]=t("div",{class:"p-4 border-b border-gray-200"},[t("h2",{class:"text-lg font-semibold text-gray-800"},"أحدث الطلبات")],-1)),t("div",ft,[t("table",wt,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," رقم الطلب "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," العميل "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," المنتج "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الإجمالي "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الحالة "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," التاريخ "),t("th",{scope:"col",class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"}," الإجراءات ")])],-1)),t("tbody",ht,[s.loading?(i(),p("tr",yt,e[11]||(e[11]=[t("td",{colspan:"7",class:"px-6 py-4 text-center text-sm text-gray-500"}," جاري تحميل البيانات... ",-1)]))):s.recentOrders.length===0?(i(),p("tr",_t,e[12]||(e[12]=[t("td",{colspan:"7",class:"px-6 py-4 text-center text-sm text-gray-500"}," لا توجد طلبات حتى الآن ",-1)]))):V("",!0),(i(!0),p(R,null,G(s.recentOrders,o=>(i(),p("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",bt," #"+a(o.id),1),t("td",kt,a(o.customer_name),1),t("td",Ct,a(s.truncateText(o.product_description,30)),1),t("td",Ot,a(s.formatCurrency(o.total)),1),t("td",St,[t("span",{class:W([s.getStatusClass(o.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},a(s.getStatusText(o.status)),3)]),t("td",Mt,a(s.formatDate(o.created_at)),1),t("td",Vt,[y(n,{to:`/orders/${o.id}`,class:"text-sky-600 hover:text-sky-900 ml-3"},{default:_(()=>e[13]||(e[13]=[b(" عرض ")])),_:2,__:[13]},1032,["to"]),s.canEditOrder(o)?(i(),X(n,{key:0,to:`/orders/edit/${o.id}`,class:"text-sky-600 hover:text-sky-900"},{default:_(()=>e[14]||(e[14]=[b(" تعديل ")])),_:2,__:[14]},1032,["to"])):V("",!0)])]))),128))])])]),t("div",jt,[y(n,{to:"/orders",class:"text-sky-600 hover:text-sky-900 text-sm font-medium"},{default:_(()=>e[16]||(e[16]=[b(" عرض جميع الطلبات ")])),_:1,__:[16]})])]),e[18]||(e[18]=K('<div class="grid grid-cols-1 lg:grid-cols-2 gap-6" data-v-e4b62f24><div class="bg-white rounded-lg shadow-sm p-4" data-v-e4b62f24><h2 class="text-lg font-semibold text-gray-800 mb-4" data-v-e4b62f24>توزيع حالات الطلبات</h2><div class="h-64 flex items-center justify-center" data-v-e4b62f24><p class="text-gray-500" data-v-e4b62f24>الرسوم البيانية غير متاحة حالياً</p></div></div><div class="bg-white rounded-lg shadow-sm p-4" data-v-e4b62f24><h2 class="text-lg font-semibold text-gray-800 mb-4" data-v-e4b62f24>المبيعات الشهرية</h2><div class="h-64 flex items-center justify-center" data-v-e4b62f24><p class="text-gray-500" data-v-e4b62f24>الرسوم البيانية غير متاحة حالياً</p></div></div></div>',1))])])}const Nt=Q(Y,[["render",Bt],["__scopeId","data-v-e4b62f24"]]);export{Nt as default};
