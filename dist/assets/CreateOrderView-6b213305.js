import{u as P,r as g,E as B,j as O,b as M,o as c,d as p,f as t,g as y,t as w,h as F,w as z,l as E,A as f,q as a,v as i,F as H,C as N}from"./vendor-24875fe8.js";import{_ as T,S as D,s as h}from"./index-38f5e110.js";import{f as L}from"./formatters-b73e5c82.js";const A={name:"CreateOrderView",components:{SidebarMenu:D},setup(){var V;const k=P(),e=g(!1),_=g(!1),o=g(JSON.parse(localStorage.getItem("user")||"{}")),l=B({customer_name:"",customer_phone:"",customer_address:"",notes:"",status:"new",tax_rate:0,tax_amount:0,subtotal:0,total:0,sales_rep_id:((V=o.value)==null?void 0:V.id)||null}),d=g([{id:1,name:"",description:"",notes:"",quantity:1,unit_price:0,subtotal:0}]),v=()=>{e.value=!e.value},x=u=>{const m=d.value[u];m.subtotal=parseFloat(m.quantity)*parseFloat(m.unit_price),s()},s=()=>{l.subtotal=d.value.reduce((u,m)=>u+(parseFloat(m.subtotal)||0),0),l.tax_amount=l.subtotal*(parseFloat(l.tax_rate)/100),l.total=l.subtotal+l.tax_amount},r=()=>{d.value.push({id:Date.now(),name:"",description:"",notes:"",quantity:1,unit_price:0,subtotal:0}),s()},n=u=>{d.value.length>1&&(d.value.splice(u,1),s())},q=()=>{var u;Object.assign(l,{customer_name:"",customer_phone:"",customer_address:"",notes:"",status:"new",tax_rate:0,tax_amount:0,subtotal:0,total:0,sales_rep_id:((u=o.value)==null?void 0:u.id)||null}),d.value=[{id:1,name:"",description:"",notes:"",quantity:1,unit_price:0,subtotal:0}]},j=async()=>{_.value=!0;try{if(!l.sales_rep_id)throw new Error("معرف المستخدم غير متوفر. يرجى تسجيل الخروج وإعادة تسجيل الدخول.");const{data:{session:u}}=await h.auth.getSession();if(!u)throw new Error("جلسة المستخدم غير متوفرة. يرجى تسجيل الخروج وإعادة تسجيل الدخول.");s(),d.value[0].description||(d.value[0].description=d.value[0].name||"منتج بدون وصف");const{data:m,error:C}=await h.from("orders").insert([{customer_name:l.customer_name,customer_phone:l.customer_phone||"",customer_address:l.customer_address||"",subtotal:parseFloat(l.subtotal),tax_rate:parseFloat(l.tax_rate),tax_amount:parseFloat(l.tax_amount),total:parseFloat(l.total),notes:l.notes||"",status:l.status,sales_rep_id:u.user.id,product_description:d.value[0].description}]).select();if(C)throw C;const S=m[0].id,I=d.value.map(b=>({order_id:S,name:b.name,description:b.description,notes:b.notes,quantity:parseFloat(b.quantity),unit_price:parseFloat(b.unit_price),subtotal:parseFloat(b.subtotal)})),{error:U}=await h.from("order_products").insert(I);if(U)throw U;k.push({name:"order-details",params:{id:S}})}catch(u){console.error("خطأ في إنشاء الطلب:",u),alert("حدث خطأ أثناء إنشاء الطلب. يرجى المحاولة مرة أخرى.")}finally{_.value=!1}};return O(()=>{s()}),{user:o,showMobileSidebar:e,toggleSidebar:v,order:l,products:d,calculateProductSubtotal:x,calculateTotals:s,addProduct:r,removeProduct:n,resetForm:q,submitOrder:j,submitting:_,formatCurrency:L}}},J={class:"min-h-screen bg-gray-50"},R={class:"flex h-screen overflow-hidden"},G={class:"flex-1 flex flex-col overflow-hidden"},K={class:"bg-white shadow-sm z-10"},Q={class:"flex items-center justify-between p-4"},W={class:"flex items-center"},X={class:"flex items-center"},Y={class:"text-sm text-gray-600 ml-2"},Z={class:"w-8 h-8 rounded-full bg-sky-500 flex items-center justify-center text-white"},$={key:0,class:"fixed inset-0 z-20 md:hidden"},tt={class:"absolute inset-y-0 right-0 w-64 bg-sky-800 text-white"},et={class:"p-4 border-b border-sky-700 flex justify-between items-center"},st={class:"flex-1 overflow-y-auto p-4"},ot={class:"flex justify-between items-center mb-6"},lt={class:"bg-white rounded-lg shadow-sm p-6"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},nt={class:"col-span-1 md:col-span-2"},at={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},it={class:"col-span-1 md:col-span-2"},dt={class:"flex justify-between items-center mb-2"},ut={class:"text-md font-semibold text-sky-700 bg-sky-50 px-3 py-1 rounded-md"},mt={class:"flex space-x-2 space-x-reverse"},ct=["onClick"],pt={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-3"},bt=["for"],ft=["id","onUpdate:modelValue"],_t=["for"],vt=["id","onUpdate:modelValue"],gt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"},xt=["for"],yt=["id","onUpdate:modelValue","onInput"],wt=["for"],ht={class:"relative"},kt=["id","onUpdate:modelValue","onInput"],Vt=["for"],Ct={class:"relative"},St=["id","onUpdate:modelValue"],Ut=["for"],Mt=["id","onUpdate:modelValue"],Ft={class:"mt-2"},qt={class:"col-span-1 md:col-span-2"},jt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},It={class:"md:col-span-1"},Pt={class:"grid grid-cols-1 gap-4"},Bt={class:"relative"},Ot={class:"relative"},zt={class:"relative"},Et={class:"md:col-span-1"},Ht={class:"mt-8 flex justify-end"},Nt=["disabled"],Tt={key:0},Dt={key:1};function Lt(k,e,_,o,l,d){const v=M("SidebarMenu"),x=M("router-link");return c(),p("div",J,[t("div",R,[y(v,{user:o.user},null,8,["user"]),t("div",G,[t("header",K,[t("div",Q,[t("div",W,[t("button",{onClick:e[0]||(e[0]=(...s)=>o.toggleSidebar&&o.toggleSidebar(...s)),class:"md:hidden ml-2"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1)])),e[16]||(e[16]=t("h2",{class:"text-xl font-semibold text-gray-800"},"إنشاء طلب جديد",-1))]),t("div",X,[t("span",Y,w(o.user.name),1),t("div",Z,w(o.user.name.charAt(0)),1)])])]),o.showMobileSidebar?(c(),p("div",$,[t("div",{class:"absolute inset-0 bg-black opacity-50",onClick:e[1]||(e[1]=(...s)=>o.toggleSidebar&&o.toggleSidebar(...s))}),t("div",tt,[t("div",et,[e[18]||(e[18]=t("h1",{class:"text-xl font-bold"},"نظام إدارة الطلبات",-1)),t("button",{onClick:e[2]||(e[2]=(...s)=>o.toggleSidebar&&o.toggleSidebar(...s))},e[17]||(e[17]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),y(v,{user:o.user,mobile:"",onItemClick:o.toggleSidebar},null,8,["user","onItemClick"])])])):F("",!0),t("main",st,[t("div",ot,[e[20]||(e[20]=t("h1",{class:"text-2xl font-bold text-gray-800"},"إنشاء طلب جديد",-1)),y(x,{to:"/orders",class:"btn bg-gray-200 text-gray-800 hover:bg-gray-300 flex items-center"},{default:z(()=>e[19]||(e[19]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),f(" العودة إلى الطلبات ")])),_:1,__:[19]})]),t("div",lt,[t("form",{onSubmit:e[14]||(e[14]=E((...s)=>o.submitOrder&&o.submitOrder(...s),["prevent"]))},[t("div",rt,[t("div",nt,[e[24]||(e[24]=t("h2",{class:"text-lg font-semibold text-gray-800 mb-4 bg-sky-50 p-2 rounded-md text-center"},"بيانات العميل",-1)),t("div",at,[t("div",null,[e[21]||(e[21]=t("label",{for:"customer_name",class:"form-label"},[f("اسم العميل "),t("span",{class:"text-red-500"},"*")],-1)),a(t("input",{type:"text",id:"customer_name","onUpdate:modelValue":e[3]||(e[3]=s=>o.order.customer_name=s),class:"form-input text-center",required:""},null,512),[[i,o.order.customer_name]])]),t("div",null,[e[22]||(e[22]=t("label",{for:"customer_phone",class:"form-label"},"رقم الهاتف",-1)),a(t("input",{type:"text",id:"customer_phone","onUpdate:modelValue":e[4]||(e[4]=s=>o.order.customer_phone=s),class:"form-input text-center"},null,512),[[i,o.order.customer_phone]])]),t("div",null,[e[23]||(e[23]=t("label",{for:"customer_address",class:"form-label"},"العنوان",-1)),a(t("input",{type:"text",id:"customer_address","onUpdate:modelValue":e[5]||(e[5]=s=>o.order.customer_address=s),class:"form-input text-center"},null,512),[[i,o.order.customer_address]])])])]),t("div",it,[e[32]||(e[32]=t("h2",{class:"text-lg font-semibold text-gray-800 mb-4 bg-sky-50 p-2 rounded-md text-center"},"بيانات المنتجات",-1)),(c(!0),p(H,null,N(o.products,(s,r)=>(c(),p("div",{key:s.id,class:"mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50"},[t("div",dt,[t("h3",ut,"المنتج "+w(r+1),1),t("div",mt,[o.products.length>1?(c(),p("button",{key:0,type:"button",onClick:n=>o.removeProduct(r),class:"text-red-600 hover:text-red-800 bg-red-50 p-1 rounded-full",title:"حذف المنتج"},e[25]||(e[25]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,ct)):F("",!0)])]),t("div",pt,[t("div",null,[t("label",{for:"product_name_"+r,class:"form-label"},e[26]||(e[26]=[f("اسم المنتج "),t("span",{class:"text-red-500"},"*",-1)]),8,bt),a(t("input",{type:"text",id:"product_name_"+r,"onUpdate:modelValue":n=>s.name=n,class:"form-input text-center bg-white",required:"",placeholder:"أدخل اسم المنتج"},null,8,ft),[[i,s.name]])]),t("div",null,[t("label",{for:"product_description_"+r,class:"form-label"},"وصف المنتج",8,_t),a(t("input",{type:"text",id:"product_description_"+r,"onUpdate:modelValue":n=>s.description=n,class:"form-input text-center bg-white",placeholder:"وصف مختصر للمنتج"},null,8,vt),[[i,s.description]])])]),t("div",gt,[t("div",null,[t("label",{for:"quantity_"+r,class:"form-label"},e[27]||(e[27]=[f("الكمية "),t("span",{class:"text-red-500"},"*",-1)]),8,xt),a(t("input",{type:"number",id:"quantity_"+r,"onUpdate:modelValue":n=>s.quantity=n,class:"form-input text-center bg-white",min:"0.01",step:"0.01",required:"",onInput:n=>o.calculateProductSubtotal(r)},null,40,yt),[[i,s.quantity]])]),t("div",null,[t("label",{for:"unit_price_"+r,class:"form-label"},e[28]||(e[28]=[f("سعر الوحدة "),t("span",{class:"text-red-500"},"*",-1)]),8,wt),t("div",ht,[a(t("input",{type:"number",id:"unit_price_"+r,"onUpdate:modelValue":n=>s.unit_price=n,class:"form-input text-center pr-8 bg-white",min:"0.01",step:"0.01",required:"",onInput:n=>o.calculateProductSubtotal(r)},null,40,kt),[[i,s.unit_price]]),e[29]||(e[29]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"€")],-1))])]),t("div",null,[t("label",{for:"subtotal_"+r,class:"form-label"},"المجموع",8,Vt),t("div",Ct,[a(t("input",{type:"number",id:"subtotal_"+r,"onUpdate:modelValue":n=>s.subtotal=n,class:"form-input text-center pr-8 bg-gray-100 font-bold",readonly:""},null,8,St),[[i,s.subtotal]]),e[30]||(e[30]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"€")],-1))])])]),t("div",null,[t("label",{for:"product_notes_"+r,class:"form-label"},"ملاحظات المنتج",8,Ut),a(t("textarea",{id:"product_notes_"+r,"onUpdate:modelValue":n=>s.notes=n,class:"form-input text-center bg-white",rows:"2",placeholder:"أي ملاحظات إضافية خاصة بالمنتج"},null,8,Mt),[[i,s.notes]])])]))),128)),t("div",Ft,[t("button",{type:"button",onClick:e[6]||(e[6]=(...s)=>o.addProduct&&o.addProduct(...s)),class:"btn bg-sky-100 text-sky-800 hover:bg-sky-200 flex items-center"},e[31]||(e[31]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 ml-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),f(" إضافة منتج آخر ")]))])]),t("div",qt,[e[41]||(e[41]=t("h2",{class:"text-lg font-semibold text-gray-800 mb-4 bg-sky-50 p-2 rounded-md text-center"},"الإجماليات والملاحظات",-1)),t("div",jt,[t("div",It,[t("div",Pt,[t("div",null,[e[34]||(e[34]=t("label",{for:"subtotal",class:"form-label"},"المجموع الفرعي",-1)),t("div",Bt,[a(t("input",{type:"number",id:"subtotal","onUpdate:modelValue":e[7]||(e[7]=s=>o.order.subtotal=s),class:"form-input text-center pr-8 bg-gray-100 font-bold",readonly:""},null,512),[[i,o.order.subtotal]]),e[33]||(e[33]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"€")],-1))])]),t("div",null,[e[35]||(e[35]=t("label",{for:"tax_rate",class:"form-label"},"نسبة الضريبة (%)",-1)),a(t("input",{type:"number",id:"tax_rate","onUpdate:modelValue":e[8]||(e[8]=s=>o.order.tax_rate=s),class:"form-input text-center bg-white",min:"0",step:"0.01",onInput:e[9]||(e[9]=(...s)=>o.calculateTotals&&o.calculateTotals(...s))},null,544),[[i,o.order.tax_rate]])]),t("div",null,[e[37]||(e[37]=t("label",{for:"tax_amount",class:"form-label"},"مبلغ الضريبة",-1)),t("div",Ot,[a(t("input",{type:"number",id:"tax_amount","onUpdate:modelValue":e[10]||(e[10]=s=>o.order.tax_amount=s),class:"form-input text-center pr-8 bg-gray-100",readonly:""},null,512),[[i,o.order.tax_amount]]),e[36]||(e[36]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"€")],-1))])]),t("div",null,[e[39]||(e[39]=t("label",{for:"total",class:"form-label"},"الإجمالي",-1)),t("div",zt,[a(t("input",{type:"number",id:"total","onUpdate:modelValue":e[11]||(e[11]=s=>o.order.total=s),class:"form-input text-center pr-8 bg-sky-50 font-bold text-sky-800 border-sky-200",readonly:""},null,512),[[i,o.order.total]]),e[38]||(e[38]=t("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[t("span",{class:"text-gray-500"},"€")],-1))])])])]),t("div",Et,[t("div",null,[e[40]||(e[40]=t("label",{for:"notes",class:"form-label"},"ملاحظات الطلب",-1)),a(t("textarea",{id:"notes","onUpdate:modelValue":e[12]||(e[12]=s=>o.order.notes=s),class:"form-input text-center bg-white",rows:"10",placeholder:"أي ملاحظات إضافية خاصة بالطلب بشكل عام"},null,512),[[i,o.order.notes]])])])])])]),t("div",Ht,[t("button",{type:"button",class:"btn bg-gray-200 text-gray-800 hover:bg-gray-300 ml-2",onClick:e[13]||(e[13]=(...s)=>o.resetForm&&o.resetForm(...s))}," إعادة تعيين "),t("button",{type:"submit",class:"btn btn-primary",disabled:o.submitting},[o.submitting?(c(),p("span",Tt,"جاري الحفظ...")):(c(),p("span",Dt,"حفظ الطلب"))],8,Nt)])],32)])])])])])}const Gt=T(A,[["render",Lt],["__scopeId","data-v-864ffb38"]]);export{Gt as default};
