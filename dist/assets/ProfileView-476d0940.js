import{r as p,E as _,a as P,j as k,o as c,d as m,f as s,t as w,l as V,q as d,v as u,H as U,h as b}from"./vendor-24875fe8.js";import{_ as q,s as x}from"./index-38f5e110.js";const M={name:"ProfileView",setup(){const l=p({}),e=p(!0),i=p(""),o=p(""),f=p(!1),r=_({name:"",email:"",phone:"",address:"",currentPassword:"",newPassword:"",confirmPassword:""}),t=P(()=>l.value.name?l.value.name.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2):"؟"),g=async()=>{e.value=!0,i.value="",o.value="";try{const{data:{session:a}}=await x.auth.getSession();if(!a){e.value=!1;return}const{data:n,error:y}=await x.from("users").select("*").eq("id",a.user.id).single();if(y)throw y;l.value=n,r.name=n.name||"",r.email=n.email||"",r.phone=n.phone||"",r.address=n.address||""}catch(a){console.error("خطأ في جلب بيانات المستخدم:",a),i.value="حدث خطأ أثناء جلب بيانات المستخدم"}finally{e.value=!1}},v=async()=>{e.value=!0,i.value="",o.value="";try{if(f.value){if(r.newPassword!==r.confirmPassword){i.value="كلمة المرور الجديدة وتأكيدها غير متطابقين",e.value=!1;return}const{error:n}=await x.auth.updateUser({password:r.newPassword});if(n)throw n}const{error:a}=await x.from("users").update({name:r.name,phone:r.phone,address:r.address,updated_at:new Date}).eq("id",l.value.id);if(a)throw a;l.value={...l.value,name:r.name,phone:r.phone,address:r.address},f.value&&(r.currentPassword="",r.newPassword="",r.confirmPassword="",f.value=!1),o.value="تم تحديث الملف الشخصي بنجاح"}catch(a){console.error("خطأ في تحديث الملف الشخصي:",a),i.value="حدث خطأ أثناء تحديث الملف الشخصي"}finally{e.value=!1}},h=a=>({admin:"مدير عام",sales_manager:"مدير مبيعات",representative:"مندوب مبيعات"})[a]||a;return k(()=>{g()}),{user:l,loading:e,error:i,success:o,form:r,showPasswordFields:f,userInitials:t,updateProfile:v,getRoleText:h}}},j={class:"min-h-screen bg-gray-50"},E={class:"container mx-auto px-4 py-8"},D={class:"bg-white rounded-lg shadow-md p-6"},F={class:"mb-8"},B={class:"flex flex-col items-center mb-6"},C={class:"w-24 h-24 bg-sky-100 rounded-full flex items-center justify-center mb-4"},S={class:"text-4xl text-sky-600"},T={class:"text-xl font-semibold text-gray-800"},I={class:"text-gray-600"},N={key:0,class:"text-center py-4"},R={class:"mb-4"},H={class:"mb-4"},z={class:"mb-4"},A={class:"mb-4"},G={class:"mb-6"},J={class:"flex items-center justify-center"},K={key:0},L={class:"mb-4"},O={class:"mb-4"},Q={class:"mb-6"},W={key:1,class:"mb-4 text-center"},X={class:"text-red-500"},Y={key:2,class:"mb-4 text-center"},Z={class:"text-green-500"},$={class:"flex items-center justify-center"},ee=["disabled"];function se(l,e,i,o,f,r){return c(),m("div",j,[s("div",E,[s("div",D,[e[18]||(e[18]=s("h1",{class:"text-2xl font-bold text-sky-700 mb-6 text-center"},"الملف الشخصي",-1)),s("div",F,[s("div",B,[s("div",C,[s("span",S,w(o.userInitials),1)]),s("h2",T,w(o.user.name||"المستخدم"),1),s("p",I,w(o.getRoleText(o.user.role)),1)]),o.loading?(c(),m("div",N,e[9]||(e[9]=[s("p",null,"جاري تحميل البيانات...",-1)]))):(c(),m("form",{key:1,onSubmit:e[8]||(e[8]=V((...t)=>o.updateProfile&&o.updateProfile(...t),["prevent"])),class:"max-w-lg mx-auto"},[s("div",R,[e[10]||(e[10]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"name"}," الاسم ",-1)),d(s("input",{type:"text",id:"name","onUpdate:modelValue":e[0]||(e[0]=t=>o.form.name=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center",required:""},null,512),[[u,o.form.name]])]),s("div",H,[e[11]||(e[11]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"email"}," البريد الإلكتروني ",-1)),d(s("input",{type:"email",id:"email","onUpdate:modelValue":e[1]||(e[1]=t=>o.form.email=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center bg-gray-100",readonly:""},null,512),[[u,o.form.email]])]),s("div",z,[e[12]||(e[12]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"phone"}," رقم الهاتف ",-1)),d(s("input",{type:"tel",id:"phone","onUpdate:modelValue":e[2]||(e[2]=t=>o.form.phone=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"},null,512),[[u,o.form.phone]])]),s("div",A,[e[13]||(e[13]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"address"}," العنوان ",-1)),d(s("textarea",{id:"address","onUpdate:modelValue":e[3]||(e[3]=t=>o.form.address=t),rows:"3",class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center"},null,512),[[u,o.form.address]])]),s("div",G,[s("div",J,[d(s("input",{type:"checkbox",id:"change-password","onUpdate:modelValue":e[4]||(e[4]=t=>o.showPasswordFields=t),class:"mr-2"},null,512),[[U,o.showPasswordFields]]),e[14]||(e[14]=s("label",{class:"text-gray-700 text-sm font-bold",for:"change-password"}," تغيير كلمة المرور ",-1))])]),o.showPasswordFields?(c(),m("div",K,[s("div",L,[e[15]||(e[15]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"current-password"}," كلمة المرور الحالية ",-1)),d(s("input",{type:"password",id:"current-password","onUpdate:modelValue":e[5]||(e[5]=t=>o.form.currentPassword=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center",required:""},null,512),[[u,o.form.currentPassword]])]),s("div",O,[e[16]||(e[16]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"new-password"}," كلمة المرور الجديدة ",-1)),d(s("input",{type:"password",id:"new-password","onUpdate:modelValue":e[6]||(e[6]=t=>o.form.newPassword=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center",required:""},null,512),[[u,o.form.newPassword]])]),s("div",Q,[e[17]||(e[17]=s("label",{class:"block text-gray-700 text-sm font-bold mb-2 text-center",for:"confirm-password"}," تأكيد كلمة المرور الجديدة ",-1)),d(s("input",{type:"password",id:"confirm-password","onUpdate:modelValue":e[7]||(e[7]=t=>o.form.confirmPassword=t),class:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline text-center",required:""},null,512),[[u,o.form.confirmPassword]])])])):b("",!0),o.error?(c(),m("div",W,[s("p",X,w(o.error),1)])):b("",!0),o.success?(c(),m("div",Y,[s("p",Z,w(o.success),1)])):b("",!0),s("div",$,[s("button",{type:"submit",class:"bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded focus:outline-none focus:shadow-outline",disabled:o.loading}," حفظ التغييرات ",8,ee)])],32))])])])])}const re=q(M,[["render",se]]);export{re as default};
